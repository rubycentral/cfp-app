var $dialog = $('#grid-time-slot-edit-dialog');
$dialog.find('.errors').html('');

<% if @time_slot.errors.present? %>
$dialog.find('.errors').html("<%= @time_slot.errors.full_messages.join(', ') %>");

<% else %>
  var $timeSlot = $('<%= "#time_slot_#{dom_id(@time_slot)}" %>');
  $timeSlot.replaceWith('<%=j render partial: 'time_slot', locals: {ts: time_slot_decorated} %>');
  $timeSlot = $($timeSlot.selector);
  var $draggableSession = $timeSlot.find('.draggable-session-card')

  var gridElement = $timeSlot.closest('[data-controller~="schedule-grid"]')[0];
  if (gridElement) {
    var controller = window.Stimulus.getControllerForElementAndIdentifier(gridElement, 'schedule-grid');
    if (controller) controller.refreshTimeSlot($timeSlot[0]);
  }

  var sessionsElement = document.querySelector('[data-controller~="draggable-sessions"]');
  if (sessionsElement && $draggableSession.length) {
    var sessionsController = window.Stimulus.getControllerForElementAndIdentifier(sessionsElement, 'draggable-sessions');
    if (sessionsController) sessionsController.initDraggableSession($draggableSession[0]);
  }

  $dialog.modal('hide');
<% end %>

document.getElementById("flash").html("<%=j show_flash %>");
