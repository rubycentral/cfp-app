(function($) {
  var $dialog = $('#bulk-time-slot-create-dialog');
  var $gridDay = $('#schedule_day_<%= @bulk.day %>');
  var $bar = $gridDay.closest('.grid-wrapper').find('.bulk-preview-bar');

  $bar.html('<%=j render partial: 'preview_bar', locals: { bulk: @bulk} %>');
  $gridDay.replaceWith('<%=j render partial: 'staff/grids/grid', locals: { schedule: @schedule, day: @bulk.day} %>');

  var gridElement = document.getElementById('schedule_day_<%= @bulk.day %>');
  if (gridElement) {
    var controller = window.Stimulus.getControllerForElementAndIdentifier(gridElement, 'schedule-grid');
    if (controller) controller.refreshDay();
  }

  // Switch to the preview day using Stimulus
  var tabsElement = document.querySelector('[data-controller~="schedule-tabs"]');
  if (tabsElement) {
    var tabsController = window.Stimulus.getControllerForElementAndIdentifier(tabsElement, 'schedule-tabs');
    if (tabsController) tabsController.showDay(<%= @bulk.day %>);
  }

  $dialog.modal('hide');

})(jQuery);
